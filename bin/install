#!/bin/bash -e

PATH=/bin/:/usr/bin:$PATH

source $OPENSHIFT_CARTRIDGE_SDK_BASH

case "$1" in
  -v|--version)
    version="$2"
esac

client_result "Install called $version"

DOWNLOAD_FILE_JBOSS="jboss-${version}.zip"
DOWNLOAD_FILE_TOMCAT="tomcat-${version}.zip"

DOWNLOAD_LOCATION="http://172.16.1.5"
COCKPIT_LOCATION="http://cockpit-prod.eu.cloudiswhoweare.com/CloudCockpit"

cd $OPENSHIFT_PLN_DIR


#Get the right DB connections 
wget --http-user=cockpit --http-password=test1234 --output-document=$OPENSHIFT_PLN_DIR/conf/planon-ds.xml $COCKPIT_LOCATION/Database/${OPENSHIFT_APP_DNS}/${version}

wget $DOWNLOAD_LOCATION/$DOWNLOAD_FILE_JBOSS

client_result "JBoss downloaded"

unzip $DOWNLOAD_FILE_JBOSS -d PlanonProCenter

client_result "JBoss unzipped"

rm $DOWNLOAD_FILE_JBOSS

chmod +x PlanonProCenter/jboss-6.1.0.Final/bin/run.sh
chmod +x PlanonProCenter/jboss-6.1.0.Final/bin/shutdown.sh

cp $OPENSHIFT_PLN_DIR/conf/jboss-service.xml PlanonProCenter/jboss-6.1.0.Final/server/default/deploy/http-invoker.sar/META-INF/
cp $OPENSHIFT_PLN_DIR/conf/jndi.properties PlanonProCenter/jboss-6.1.0.Final/server/default/conf/
cp $OPENSHIFT_PLN_DIR/conf/hornetq-jms.xml PlanonProCenter/jboss-6.1.0.Final/server/default/deploy/hornetq/
cp $OPENSHIFT_PLN_DIR/conf/planon-ds.xml PlanonProCenter/jboss-6.1.0.Final/server/default/deploy

exit 0
